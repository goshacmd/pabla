{"version":3,"sources":["actions.js","Container.jsx","createCanvasComponent.js","index.js","Card.jsx","DownloadButton.jsx","FiltersPicker.jsx","ImageCanvas.jsx","ImagePicker.jsx","Option.jsx","SearchBar.jsx","SizePicker.jsx","TextPropertiesPicker.jsx","App.jsx","LeftSidebar.jsx","RightSidebar.jsx","initialize.js","reducer.js","canvas.js","imageCache.js","text.js","textEditor.js","unsplash.js"],"names":[],"mappings":"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","file":"public/app.js","sourcesContent":["import {getPopularImages, searchImages as _searchImages} from 'util/unsplash';\n\nexport const setFont = (font) => ({\n  type: 'SET_FONT',\n  font\n});\n\nexport const setFontSize = (size) => ({\n  type: 'SET_FONT_SIZE',\n  size\n});\n\nexport const setBold = (bold) => ({\n  type: 'SET_BOLD',\n  bold\n});\n\nexport const setItalic = (italic) => ({\n  type: 'SET_ITALIC',\n  italic\n});\n\nexport const setColor = (color) => ({\n  type: 'SET_COLOR',\n  color\n});\n\nexport const setFilter = (filter) => ({\n  type: 'SET_FILTER',\n  filter\n});\n\nexport const selectImage = (image) => ({\n  type: 'SELECT_IMAGE',\n  image\n});\n\nexport const setSize = (size) => ({\n  type: 'SET_SIZE',\n  size\n});\n\nexport const setText = (text) => ({\n  type: 'SET_TEXT',\n  text\n});\n\nexport const cacheDrawing = (drawing) => ({\n  type: 'CACHE_DRAWING',\n  drawing\n});\n\nexport const setQuery = (query) => ({\n  type: 'SET_QUERY',\n  query\n});\n\n\nexport const initialFetchImages = () => {\n  return dispatch => {\n    getPopularImages().then(images => {\n      dispatch({ type: 'RECEIVE_IMAGES', images });\n      dispatch(selectImage(images[0]));\n    });\n  };\n};\n\nexport const searchImages = (query) => {\n  return dispatch => {\n    _searchImages(query).then(images => {\n      dispatch({ type: 'RECEIVE_IMAGES', images });\n    });\n  };\n};\n\nexport const resetSearch = () => {\n  return dispatch => {\n    getPopularImages().then(images => {\n      dispatch({ type: 'RECEIVE_IMAGES', images });\n    });\n  };\n};\n","import React from 'react';\n\nimport ReactUpdates from 'react/lib/ReactUpdates';\nimport ReactMultiChild from 'react/lib/ReactMultiChild';\nimport ReactInstanceMap from 'react/lib/ReactInstanceMap';\n\nimport {renderCanvasLayout} from 'util/canvas';\n\nconst Container = Object.assign({}, ReactMultiChild.Mixin, {\n  mountAndInjectChildren(children, tx, ct) {\n    const mounted = this.mountChildren(children, tx, ct);\n    window.requestAnimationFrame(this._draw);\n  },\n\n  updateChildren(children, tx, ct) {\n    this.mountAndInjectChildren(children, tx, ct);\n  }\n});\n\nexport default React.createClass({\n  mixins: [Container],\n\n  render() {\n    const {width, height} = this.props;\n    const {onMouseDown, onMouseMove, onMouseUp} = this.props\n    const style = { width, height };\n    const scale = window.devicePixelRatio || 1;\n    return <canvas ref=\"canvas\" width={width*scale} height={height*scale} style={style} {...{onMouseDown, onMouseMove, onMouseUp}} />\n  },\n\n  scaleCanvas() {\n    this.refs.canvas.getContext('2d').scale(window.devicePixelRatio || 1, window.devicePixelRatio || 1);\n  },\n\n  componentDidMount() {\n    this._debugID = this._reactInternalInstance._debugID;\n\n    const tx = ReactUpdates.ReactReconcileTransaction.getPooled();\n    tx.perform(this.mountAndInjectChildren, this, this.props.children, tx, ReactInstanceMap.get(this)._context);\n    ReactUpdates.ReactReconcileTransaction.release(tx);\n\n    this.scaleCanvas();\n  },\n\n  componentDidUpdate(oldProps) {\n    // TODO: update children instead\n    const tx = ReactUpdates.ReactReconcileTransaction.getPooled();\n    tx.perform(this.updateChildren, this, this.props.children, tx, ReactInstanceMap.get(this)._context);\n    ReactUpdates.ReactReconcileTransaction.release(tx);\n\n    if (oldProps.height !== this.props.height || oldProps.width !== this.props.width) {\n      this.scaleCanvas();\n    }\n  },\n\n  _draw() {\n    const layoutChildren = Object.keys(this._renderedChildren).map(key => {\n      const child = this._renderedChildren[key];\n      const node = child.getNativeNode();\n      return node;\n    });\n\n    const layout = {\n      frame: [0, 0, this.props.width, this.props.height],\n      children: layoutChildren\n    };\n\n    const canvas = this.refs.canvas;\n    const ctx = canvas.getContext('2d');\n    const {width, height} = this.props;\n    ctx.clearRect(0, 0, width, height);\n\n    renderCanvasLayout(ctx, layout);\n\n    this.props.onRedraw && this.props.onRedraw(canvas.toDataURL('image/jpeg'));\n  }\n});\n","export default (name, drawFn) => {\n  const CanvasComp = function(el) {\n    this._el = el;\n  };\n  CanvasComp.displayName = 'Rect';\n  Object.assign(CanvasComp.prototype, {\n    construct() {\n    },\n    mountComponent(transaction, hostParent, hostContainerInfo, context) {\n      return {};\n    },\n    receiveComponent() {\n    },\n    unmountComponent() {\n    },\n    getNativeNode() {\n      return drawFn(this._el.props);\n    },\n    getPublicInstance() {\n      return drawFn(this._el.props);\n    }\n  });\n  return CanvasComp;\n};\n","import Container from './Container';\nimport createCanvasComponent from './createCanvasComponent';\n\nexport const CanvasRect = createCanvasComponent('CanvasRect', (props) => Object.assign({ type: 'rect' }, props));\nexport const CanvasFilter = createCanvasComponent('CanvasFilter', (props) => Object.assign({ type: 'filter' }, props));\nexport const CanvasImage = createCanvasComponent('CanvasImage', (props) => Object.assign({ type: 'image' }, props));\nexport const CanvasText = createCanvasComponent('CanvasText', (props) => Object.assign({ type: 'text' }, props));\nexport const CanvasOutline = createCanvasComponent('CanvasOutline', (props) => Object.assign({ type: 'outline' }, props));\nexport const CanvasLine = createCanvasComponent('CanvasLine', (props) => Object.assign({ type: 'line' }, props));\nexport const Canvas = Container;\n","import React from 'react';\n\nexport default ({ title, children }) => {\n  return <div className=\"Card\">\n    <div className=\"Card-header\"><h4>{title}</h4></div>\n    {children}\n  </div>\n};\n","import React from 'react';\n\nexport default React.createClass({\n  propTypes: {\n    drawing: React.PropTypes.string\n  },\n\n  handleDownload(e) {\n    const uri = this.props.drawing;\n    const link = e.target;\n    link.href = uri;\n    link.click();\n  },\n\n  render() {\n    return <div>\n      <a className=\"Button\" download=\"pabla.jpg\" target=\"_blank\" onClick={this.handleDownload}>Download</a>\n    </div>;\n  }\n});\n","import React from 'react';\n\nexport default React.createClass({\n  propTypes: {\n    filter: React.PropTypes.oneOf(['none', 'light_contrast', 'heavy_contrast']).isRequired,\n    onFilterChange: React.PropTypes.func.isRequired\n  },\n\n  updateFilter() {\n    const val = this.refs.select.value;\n    this.props.onFilterChange(val);\n  },\n\n  render() {\n    return <div>\n      <select className=\"FiltersPicker\" value={this.props.filter} ref=\"select\" onChange={this.updateFilter}>\n        <option value=\"none\">None</option>\n        <option value=\"light_contrast\">Light contrast</option>\n        <option value=\"heavy_contrast\">Heavy contrast</option>\n      </select>\n    </div>;\n  }\n});\n","import React from 'react';\nimport {Canvas, CanvasRect, CanvasFilter, CanvasImage, CanvasText, CanvasOutline, CanvasLine} from './Canvas';\n\nimport {getImage} from 'util/imageCache';\n\nimport {findIdxForCursor, findPosForCursor, findCoordsForPos, findRectsForSelection} from 'util/text';\nimport TextEditor from 'util/textEditor';\n\nconst _ctx = document.createElement('canvas').getContext('2d');\n\nconst keys = {\n  8:  'backspace',\n  27: 'escape',\n  37: 'arr_left',\n  39: 'arr_right'\n};\n\nconst SIZES = {\n  tall: [500, 750],\n  square: [500, 500],\n  wide: [500, 250]\n};\n\nconst getMousePos = (e, canvas) => {\n  const rect = canvas.getBoundingClientRect();\n  const mousePos = {\n    x: e.clientX - rect.left,\n    y: e.clientY - rect.top\n  };\n  return mousePos;\n};\n\nconst isInRect = (pos, rect) => {\n  return (pos.x >= rect[0] && pos.x <= rect[0] + rect[2]) && (pos.y >= rect[1] && pos.y <= rect[1] + rect[3]);\n};\n\nconst applyMouseDiff = (textRect, mouseDiff) => {\n  return [textRect[0]-mouseDiff.x, textRect[1]-mouseDiff.y, textRect[2], textRect[3]];\n};\n\n// TODO:\n// wait for image loading\nexport default React.createClass({\n  initSize(size) {\n    const obj = {};\n    [obj.canvasWidth, obj.canvasHeight] = SIZES[size];\n    const state = this.state;\n    if (state.canvasWidth === obj.canvasWidth && state.canvasHeight === obj.canvasHeight) {\n      return Promise.resolve();\n    } else {\n      return new Promise(resolve => {\n        this.setState(obj, resolve);\n      });\n    }\n  },\n\n  loadImage(url) {\n    if (!url) return Promise.resolve();\n    if (this.props.image !== url) this.setState({ image: null });\n    return getImage(url).then(img => {\n      this.setState({ image: img });\n    });\n  },\n\n  componentWillReceiveProps(nextProps) {\n    Promise.all([this.initSize(nextProps.size), this.loadImage(nextProps.image)]).then(() => {\n      this.redraw(nextProps);\n    });\n  },\n\n  getInitialState() {\n    this.textEditor = new TextEditor(this);\n    return {};\n  },\n\n  componentWillMount() {\n    Promise.all([this.initSize(this.props.size), this.loadImage(this.props.image)]);\n  },\n\n  componentDidMount() {\n    this.textRect = [20, 20, this.state.canvasWidth - 40, this.state.canvasHeight - 40];\n    window.requestAnimationFrame(this.doRedraw);\n\n    setInterval(() => {\n      if (this.state.isEditing) {\n        this.textEditor.toggleCursor();\n        window.requestAnimationFrame(this.doRedraw);\n      }\n    }, 450);\n  },\n\n  doRedraw() {\n    this.redraw(this.props);\n  },\n\n  redraw(nextProps) {\n    if (!nextProps) nextProps = this.props;\n    this.forceUpdate();\n  },\n\n  cancelEditing() {\n    this.setState({ isEditing: false });\n  },\n\n  updateCursor(e) {\n    if (keys[e.which] === 'escape') {\n      this.cancelEditing();\n      e.target.blur();\n    }\n\n    const {selectionStart, selectionEnd} = this.refs.txt;\n    this.textEditor.setFromInput(selectionStart, selectionEnd);\n\n    setTimeout(this.doRedraw, 0);\n  },\n\n  setFocus() {\n    this.setState({ isFocused: true });\n  },\n\n  setEditing() {\n    this.setState({ isFocused: true, isEditing: true });\n  },\n\n  setNoFocus() {\n    this.setState({ isFocused: false, isEditing: false });\n  },\n\n  handleMouseDown(e) {\n    const mousePos = getMousePos(e, this.refs.canvas.refs.canvas);\n    this.startPos = mousePos;\n\n    const textRect = this.textRect;\n    const isInTextRect = isInRect(mousePos, textRect);\n\n    if (isInTextRect) {\n      this.mouseHeld = true;\n      if (this.state.isFocused) {\n        this.mouseDown = new Date;\n      }\n      this.setFocus();\n    } else {\n      this.setNoFocus();\n    }\n  },\n\n  handleMouseMove(e) {\n    if (!this.mouseHeld) return;\n\n    // move\n    const {startPos} = this;\n    const mousePos = getMousePos(e, this.refs.canvas.refs.canvas);\n\n    const mouseDiff = {\n      x: startPos.x - mousePos.x,\n      y: startPos.y - mousePos.y\n    };\n\n    const {isFocused, isEditing} = this.state;\n\n    if (isFocused && !isEditing) {\n      this.textRect = applyMouseDiff(this.textRect, mouseDiff);\n      this.mouseDiff = mouseDiff;\n      this.startPos = mousePos;\n    } else if (isFocused && isEditing) {\n      const cursor1 = startPos;\n      const cursor2 = mousePos;\n\n      const {textRect} = this;\n      const {text, textAttrs} = this.props;\n      let idx1 = findIdxForCursor(_ctx, textRect, cursor1, textAttrs, text);\n      let idx2 = findIdxForCursor(_ctx, textRect, cursor2, textAttrs, text);\n      this.textEditor.setSelection(idx1, idx2, this.refs.txt);\n    }\n\n    setTimeout(this.doRedraw, 0);\n  },\n\n  handleMouseUp(e) {\n    if (this.mouseDown && (new Date - this.mouseDown) < 200) {\n      const {textRect, startPos} = this;\n      const {text, textAttrs} = this.props;\n      const cursor = findIdxForCursor(_ctx, textRect, startPos, textAttrs, text);\n      this.textEditor.setCursor(cursor, this.refs.txt);\n      this.setEditing();\n      this.refs.txt.focus();\n    }\n\n    this.mouseDiff = null;\n    this.mouseDown = null;\n    this.mouseHeld = false;\n    setTimeout(this.doRedraw, 0);\n  },\n\n  getSelectionRects() {\n    const {textEditor, textRect} = this;\n    const {cursor1, cursor2} = textEditor;\n\n    if (this.state.isEditing && cursor1 >= 0 && cursor2 >= 0) {\n      const {textAttrs, text} = this.props;\n      const rects = findRectsForSelection(_ctx, textRect, cursor1, cursor2, textAttrs, text);\n      if (rects) {\n        return rects.map((rect, i) => {\n          const {x1,x2,y1,y2} = rect;\n          return [x1, y1, x2-x1, y2-y1];\n        });\n      }\n    }\n\n    return [];\n  },\n\n  getCursorCoords(selRects = []) {\n    const {textEditor, textRect} = this;\n    const {cursor, showCursor} = textEditor;\n\n    if (this.state.isEditing && showCursor && selRects.length === 0) {\n      const {textAttrs, text} = this.props;\n      const pos = findPosForCursor(_ctx, cursor, textAttrs, text);\n      if (pos) {\n        return findCoordsForPos(_ctx, textRect, textAttrs, text, pos);\n      }\n    }\n  },\n\n  render() {\n    const img = this.state.image;\n    const {canvasWidth, canvasHeight, isFocused, isEditing} = this.state;\n    const {filter, textAttrs, text} = this.props;\n    const {textRect, mouseHeld, textEditor} = this;\n    const mainFrame = [0, 0, canvasWidth, canvasHeight];\n\n    const selectionRectFrames = this.getSelectionRects();\n    const selectionRects = selectionRectFrames.map((frame, i) => {\n      return <CanvasRect key={i} fill=\"rgba(87, 205, 255, 0.5)\" frame={frame} />\n    });\n\n    const cursorCoords = this.getCursorCoords(selectionRectFrames);\n\n    return <div className=\"ImageCanvas\">\n      <Canvas\n        ref=\"canvas\"\n        width={canvasWidth}\n        height={canvasHeight}\n        onRedraw={this.props.onRedraw}\n        onMouseDown={this.handleMouseDown}\n        onMouseMove={this.handleMouseMove}\n        onMouseUp={this.handleMouseUp}>\n        {img ?\n          <CanvasImage image={img} frame={mainFrame} /> :\n          null}\n        <CanvasFilter filter={filter} frame={mainFrame} />\n        {textRect ?\n          <CanvasText ref=\"textRect\" text={text} frame={textRect} textAttrs={textAttrs} onUpdateRect={newRect => this.textRect = newRect} /> :\n          null}\n        {textRect && isFocused ?\n          <CanvasOutline width={2} frame={textRect} color={mouseHeld ? 'rgba(87, 205, 255, 0.5)' : '#0092d1'} /> :\n          null}\n        {cursorCoords ?\n          <CanvasLine color=\"rgba(255, 255, 255, 0.75)\" width={1} from={[cursorCoords.x, cursorCoords.y1]} to={[cursorCoords.x, cursorCoords.y2]} /> :\n          null}\n        {selectionRects}\n      </Canvas>\n\n      <textarea\n        ref=\"txt\"\n        value={text}\n        onChange={e => this.props.onTextChange(e.target.value)}\n        onKeyUp={this.updateCursor}\n        onFocus={this.setEditing}\n        style={{height: 1, width: 1, opacity: 0}} />\n    </div>\n  }\n});\n","import React from 'react';\nimport Option from './Option';\n\nexport default React.createClass({\n  propTypes: {\n    images: React.PropTypes.arrayOf(React.PropTypes.shape({ url: React.PropTypes.string })).isRequired,\n    selected: React.PropTypes.shape({ url: React.PropTypes.string }),\n    onSelect: React.PropTypes.func\n  },\n\n  handleSelect(image) {\n    this.props.onSelect && this.props.onSelect(image);\n  },\n\n  render() {\n    const selected = this.props.selected || {};\n    return <div className=\"ImagePicker\">\n      {this.props.images.map(image => {\n        const sel = image.url === selected.url;\n        const className = 'ImagePicker-image' + (sel ? ' ImagePicker-image--selected' : '');\n        const imageUrl = image.url + \"&w=364\";\n\n        return <div className={className} onClick={this.handleSelect.bind(this, image)} key={image.url}>\n          <Option selected={sel} borderStyle=\"thick-transparent\">\n              <img src={imageUrl}/ >\n          </Option>\n        </div>;\n      })}\n    </div>;\n  }\n});\n","import React from 'react';\n\nexport default ({ selected, checkSize, borderStyle, children }) => {\n  if (!checkSize) checkSize = 'normal';\n  if (!borderStyle) borderStyle = 'thin-grey';\n\n  const className = `OptionWrapper OptionWrapper--size-${checkSize} OptionWrapper--border-${borderStyle}` + (selected ? \" OptionWrapper--selected\" : \"\");\n\n  return <div className={className}>\n    <div className=\"OptionWrapper-w\">\n      {children}\n    </div>\n  </div>;\n};\n","import React from 'react';\n\nexport default React.createClass({\n  propTypes: {\n    query: React.PropTypes.string.isRequired,\n    onSearch: React.PropTypes.func.isRequired,\n    onSearchReset: React.PropTypes.func.isRequired,\n    onQueryChange: React.PropTypes.func.isRequired\n  },\n\n  search(e) {\n    e.preventDefault();\n\n    const value = this.props.query;\n\n    if (value && value.length > 0) {\n      this.props.onSearch(value);\n    } else {\n      this.props.onSearchReset();\n    }\n  },\n\n  setQuery(e) {\n    e.preventDefault();\n    const value = e.target.value;\n    this.props.onQueryChange && this.props.onQueryChange(value);\n  },\n\n  render() {\n    return <form onSubmit={this.search}>\n      <input type=\"text\" className=\"SearchBar\" placeholder=\"Search images\" onChange={this.setQuery} value={this.props.query} />\n    </form>;\n  }\n});\n","import React from 'react';\nimport Option from './Option';\n\nconst SizeItem = ({ name, code, currentCode, onSelect }) => {\n  const onClick = (e) => {\n    e.preventDefault();\n    onSelect(code);\n  };\n  const className = `SizePicker-size SizePicker-size--${code}`;\n\n  return <div className={className} onClick={onClick}>\n    <Option selected={code === currentCode}>\n      {name}\n    </Option>\n  </div>\n};\n\nexport default React.createClass({\n  render() {\n    const size = this.props.size;\n\n    return <div className=\"SizePicker\">\n      <SizeItem name=\"Tall\" code=\"tall\" currentCode={size} onSelect={this.props.onSizeSelect} />\n      <SizeItem name=\"Square\" code=\"square\" currentCode={size} onSelect={this.props.onSizeSelect} />\n      <SizeItem name=\"Wide\" code=\"wide\" currentCode={size} onSelect={this.props.onSizeSelect} />\n    </div>;\n  }\n});\n","import React from 'react';\nimport Option from './Option';\n\nconst colors = [\n  'white',\n  'black',\n  '#444',\n  '#007fff',\n  '#ffb300',\n  '#71c318'\n];\n\nconst fonts = ['Arial', 'Georgia', 'Helvetica', 'Trebuchet MS'];\nconst fontSizes = [8, 10, 12, 14, 16, 18, 20, 22, 26, 32, 36, 42, 48, 54];\n\nexport default React.createClass({\n  propTypes: {\n    textAttrs: React.PropTypes.shape({\n      font: React.PropTypes.string.isRequired,\n      fontSize: React.PropTypes.number.isRequired,\n      color: React.PropTypes.string.isRequired,\n      bold: React.PropTypes.bool.isRequired,\n      italic: React.PropTypes.bool.isRequired,\n    }).isRequired,\n    onFontChange: React.PropTypes.func.isRequired,\n    onFontSizeChange: React.PropTypes.func.isRequired,\n    onColorChange: React.PropTypes.func.isRequired\n  },\n\n  updateFont() {\n    const val = this.refs.font.value;\n    this.props.onFontChange(val);\n  },\n\n  updateFontSize() {\n    const val = parseInt(this.refs.fontSize.value, 10);\n    this.props.onFontSizeChange(val);\n  },\n\n  updateColor(color) {\n    this.props.onColorChange(color);\n  },\n\n  updateBold() {\n    this.props.onBoldChange(!this.props.textAttrs.bold);\n  },\n\n  updateItalic() {\n    this.props.onItalicChange(!this.props.textAttrs.italic);\n  },\n\n  render() {\n    const {font, fontSize, color, bold, italic} = this.props.textAttrs;\n    return <div className=\"TextPropsPicker\">\n      <p>\n        Font:\n        <select ref=\"font\" value={font} onChange={this.updateFont}>\n          {fonts.map(s => <option key={s} value={s}>{s}</option>)}\n        </select>\n      </p>\n      <p>\n        Font size:\n        <select ref=\"fontSize\" value={fontSize} onChange={this.updateFontSize}>\n          {fontSizes.map(s => <option key={s} value={s}>{s}</option>)}\n        </select>\n      </p>\n\n      <div className=\"TextPropsPicker-style\">\n        <div className=\"TextPropsPicker-style-bold\" onClick={this.updateBold}>\n          <Option selected={bold}>\n            <span>Bold</span>\n          </Option>\n        </div>\n        <div className=\"TextPropsPicker-style-italic\" onClick={this.updateItalic}>\n          <Option selected={italic}>\n            <span>Italic</span>\n          </Option>\n        </div>\n      </div>\n\n      <div className=\"TextPropsPicker-colors\">\n        {colors.map(color => {\n          return <div key={color} className=\"TextPropsPicker-color\" onClick={this.updateColor.bind(this, color)}>\n            <Option selected={color === this.props.textAttrs.color} checkSize=\"small\">\n              <div style={{background: color, borderRadius: 3}} />\n            </Option>\n          </div>;\n        })}\n      </div>\n    </div>;\n  }\n});\n","import React from 'react';\nimport {connect} from 'react-redux';\nimport {cacheDrawing, setText} from 'actions';\n\nimport LeftSidebar from './LeftSidebar';\nimport RightSidebar from './RightSidebar';\nimport ImageCanvas from 'components/ImageCanvas';\n\nconst App = React.createClass({\n  updateDrawnImage(data) {\n    if (this.props.drawing === data) return;\n    this.props.onCacheDrawing(data);\n  },\n\n  render() {\n    const selectedUrl = this.props.selected && this.props.selected.url;\n    const {text, textAttrs, filter, size} = this.props;\n    return (\n      <div className=\"Container\">\n        <LeftSidebar />\n        <div className=\"Main\">\n          <h4 className=\"Main-subtitle\">Canvas</h4>\n          <ImageCanvas\n            image={selectedUrl}\n            text={text}\n            textAttrs={textAttrs}\n            filter={filter}\n            size={size}\n            onRedraw={this.updateDrawnImage}\n            onTextChange={this.props.onTextChange} />\n        </div>\n        <RightSidebar />\n      </div>\n    );\n  }\n});\n\nconst mapStateToProps = (state) => ({\n  textAttrs: state.textAttrs,\n  filter: state.filter,\n  size: state.size,\n  selected: state.selectedImage,\n  drawing: state.drawing,\n  text: state.text\n});\n\nconst mapDispatchToProps = (dispatch) => ({\n  onCacheDrawing(drawing) {\n    dispatch(cacheDrawing(drawing));\n  },\n\n  onTextChange(text) {\n    dispatch(setText(text));\n  }\n});\n\nexport default connect(mapStateToProps, mapDispatchToProps)(App);\n","import React from 'react';\nimport {connect} from 'react-redux';\nimport {selectImage, searchImages, resetSearch, setQuery} from 'actions';\n\nimport Card from 'components/Card';\nimport SearchBar from 'components/SearchBar';\nimport ImagePicker from 'components/ImagePicker';\n\nconst LeftSidebar = ({ query, availableImages, selectedImage, onSelectImage, onSearch, onSearchReset, onQueryChange}) => {\n  return <div className=\"Sidebar\">\n    <Card title=\"Images\">\n      <SearchBar\n        query={query}\n        onSearch={onSearch}\n        onSearchReset={onSearchReset}\n        onQueryChange={onQueryChange} />\n      <ImagePicker\n        images={availableImages}\n        selected={selectedImage}\n        onSelect={onSelectImage} />\n    </Card>\n  </div>;\n};\n\nconst mapStateToProps = (state) => ({\n  availableImages: state.availableImages,\n  selectedImage: state.selectedImage,\n  query: state.query\n});\n\nconst mapDispatchToProps = (dispatch) => ({\n  onSelectImage(image) {\n    dispatch(selectImage(image));\n  },\n\n  onSearch(query) {\n    dispatch(searchImages(query));\n  },\n\n  onSearchReset() {\n    dispatch(resetSearch());\n  },\n\n  onQueryChange(query) {\n    dispatch(setQuery(query));\n  }\n});\n\nexport default connect(mapStateToProps, mapDispatchToProps)(LeftSidebar);\n","import React from 'react';\nimport {connect} from 'react-redux';\nimport {setFilter, setFont, setFontSize, setColor, setBold, setItalic, setSize} from 'actions';\n\nimport Card from 'components/Card';\nimport FiltersPicker from 'components/FiltersPicker';\nimport TextPropertiesPicker from 'components/TextPropertiesPicker';\nimport SizePicker from 'components/SizePicker';\nimport DownloadButton from 'components/DownloadButton';\n\nconst RightSidebar = ({ drawing, filter, onFilterChange, textAttrs, onFontChange, onFontSizeChange, onColorChange, onBoldChange, onItalicChange, size, onSizeSelect }) => {\n  return <div className=\"Sidebar\">\n    <Card title=\"Sizes\">\n      <SizePicker size={size} onSizeSelect={onSizeSelect} />\n    </Card>\n    <Card title=\"Filters\">\n      <FiltersPicker filter={filter} onFilterChange={onFilterChange} />\n    </Card>\n    <Card title=\"Text\">\n      <TextPropertiesPicker\n        textAttrs={textAttrs}\n        onFontChange={onFontChange}\n        onFontSizeChange={onFontSizeChange}\n        onColorChange={onColorChange}\n        onBoldChange={onBoldChange}\n        onItalicChange={onItalicChange} />\n    </Card>\n    <DownloadButton drawing={drawing} />\n    <p className=\"Credit\">\n      Made by <a href=\"http://goshakkk.name\">Gosha Arinich</a>. <a href=\"https://github.com/goshakkk/pabla\">Repo</a>.\n    </p>\n  </div>;\n};\n\nconst mapStateToProps = (state) => ({\n  textAttrs: state.textAttrs,\n  filter: state.filter,\n  size: state.size,\n  drawing: state.drawing\n});\n\nconst mapDispatchToProps = (dispatch) => ({\n  onFontChange(font) {\n    dispatch(setFont(font));\n  },\n\n  onFontSizeChange(size) {\n    dispatch(setFontSize(size));\n  },\n\n  onColorChange(color) {\n    dispatch(setColor(color));\n  },\n\n  onBoldChange(bold) {\n    dispatch(setBold(bold));\n  },\n\n  onItalicChange(italic) {\n    dispatch(setItalic(italic));\n  },\n\n  onFilterChange(filter) {\n    dispatch(setFilter(filter));\n  },\n\n  onSizeSelect(size) {\n    dispatch(setSize(size));\n  }\n});\n\nexport default connect(mapStateToProps, mapDispatchToProps)(RightSidebar);\n","require('es6-promise').polyfill();\n\nimport ReactDOM from 'react-dom';\nimport React from 'react';\nimport {createStore, applyMiddleware} from 'redux';\nimport thunkMiddleware from 'redux-thunk';\nimport {Provider} from 'react-redux';\n\nimport reducer from 'reducer';\nimport App from 'container/App';\n\nimport {initialFetchImages} from 'actions';\n\nconst store = createStore(reducer, applyMiddleware(thunkMiddleware));\n\nstore.dispatch(initialFetchImages());\n\ndocument.addEventListener('DOMContentLoaded', () => {\n  ReactDOM.render(\n    <Provider store={store}>\n      <App />\n    </Provider>,\n    document.querySelector('#app')\n  );\n});\n","import {getPopularImages} from 'util/unsplash';\n\nconst images = getPopularImages();\n\nconst initialState = {\n  filter: 'light_contrast',\n  availableImages: [],\n  selectedImage: null,\n  query: \"\",\n  drawing: null,\n  size: 'square',\n  text: 'Others have seen what is and asked why. I have seen what could be and asked why not.\\n- Pablo Picasso',\n  textAttrs: {\n    fontSize: 32,\n    color: 'white',\n    font: 'Georgia',\n    bold: false,\n    italic: false\n  }\n};\n\nexport default function(state = initialState, action) {\n  let textAttrs;\n  switch (action.type) {\n    case 'SET_FONT':\n      textAttrs = Object.assign({}, state.textAttrs, { font: action.font });\n      return Object.assign({}, state, { textAttrs });\n    case 'SET_FONT_SIZE':\n      textAttrs = Object.assign({}, state.textAttrs, { fontSize: action.size });\n      return Object.assign({}, state, { textAttrs });\n    case 'SET_BOLD':\n      textAttrs = Object.assign({}, state.textAttrs, { bold: action.bold });\n      return Object.assign({}, state, { textAttrs });\n    case 'SET_ITALIC':\n      textAttrs = Object.assign({}, state.textAttrs, { italic: action.italic });\n      return Object.assign({}, state, { textAttrs });\n    case 'SET_COLOR':\n      textAttrs = Object.assign({}, state.textAttrs, { color: action.color });\n      return Object.assign({}, state, { textAttrs });\n    case 'SET_FILTER':\n      return Object.assign({}, state, { filter: action.filter });\n    case 'SELECT_IMAGE':\n      return Object.assign({}, state, { selectedImage: action.image });\n    case 'SET_SIZE':\n      return Object.assign({}, state, { size: action.size });\n    case 'SET_TEXT':\n      return Object.assign({}, state, { text: action.text });\n    case 'CACHE_DRAWING':\n      return Object.assign({}, state, { drawing: action.drawing });\n    case 'RECEIVE_IMAGES':\n      return Object.assign({}, state, { availableImages: action.images });\n    case 'SET_QUERY':\n      return Object.assign({}, state, { query: action.query });\n    default:\n      return state;\n  }\n}\n","import {addText} from 'util/text';\n\nconst canvasComponents = {\n  image(ctx, child) {\n    drawImage(ctx, child.frame, child.image);\n  },\n  filter(ctx, child) {\n    const {filter} = child;\n    if (filter === 'none') return;\n    const value = filter === 'light_contrast' ? 0.35 : 0.65;\n    applyContrast(ctx, child.frame, value);\n  },\n  text(ctx, child) {\n    const rect = addText(ctx, child.textAttrs, child.frame, child.text);\n    if (child.frame.join(',') !== rect.join(',')) {\n      child.onUpdateRect && child.onUpdateRect(rect);\n    }\n  },\n  rect(ctx, child) {\n    ctx.fillStyle = child.fill;\n    ctx.fillRect(...child.frame);\n  },\n  outline(ctx, child) {\n    ctx.lineWidth = child.width;\n    ctx.strokeStyle = child.color;\n    ctx.strokeRect(...child.frame);\n  },\n  line(ctx, child) {\n    ctx.strokeStyle = child.color;\n    ctx.lineWidth = child.width;\n    ctx.lineCap = 'round';\n    ctx.beginPath();\n    ctx.moveTo(...child.from);\n    ctx.lineTo(...child.to);\n    ctx.stroke();\n    ctx.strokeStyle = null;\n  }\n};\n\nconst applyContrast = (ctx, frame, value) => {\n  ctx.fillStyle = `rgba(45, 45, 45, ${value})`;\n  ctx.fillRect(...frame);\n};\n\nconst drawImage = (ctx, frame, img) => {\n  const canvasWidth = frame[2];\n  const canvasHeight = frame[3];\n\n  const imgWidth = img.naturalWidth;\n  const imgHeight = img.naturalHeight;\n\n  const origRatio = imgWidth / imgHeight;\n  const canvasRatio = canvasWidth / canvasHeight;\n\n  // determine crop\n  let zoneWidth, zoneHeight;\n  if (canvasRatio >= origRatio) {\n    zoneWidth = imgWidth;\n    zoneHeight = imgWidth / canvasRatio;\n  } else {\n    zoneWidth = imgHeight * canvasRatio;\n    zoneHeight = imgHeight;\n  }\n\n  // center\n  const xPad = (imgWidth - zoneWidth) / 2;\n  const yPad = (imgHeight - zoneHeight) / 2;\n\n  ctx.drawImage(img, xPad, yPad, zoneWidth, zoneHeight, 0, 0, canvasWidth, canvasHeight);\n};\n\nexport const renderCanvasLayout = (ctx, layout) => {\n  layout.children.forEach(child => {\n    if (!child) return;\n    const renderer = canvasComponents[child.type];\n    if (!renderer) console.error(`Unknown canvas component: ${child.type}`);\n    renderer(ctx, child);\n  });\n};\n","const _cache = {};\n\nconst _get = (src) => {\n  const img = new Image();\n  img.crossOrigin = 'anonymous';\n  img.src = src;\n\n  return new Promise((resolve, reject) => {\n    img.onload = () => resolve(img);\n  });\n};\n\nexport const getImage = (src) => {\n  if (src in _cache) {\n    return _cache[src];\n  } else {\n    const img = _get(src);\n    _cache[src] = img;\n    return img;\n  }\n};\n","const CANVAS_WIDTH = 500;\nconst MAX_TEXT_WIDTH = CANVAS_WIDTH - 40 - 10;\n\nconst setupCtx = (ctx, textAttrs) => {\n  const {bold, italic, font, fontSize, color} = textAttrs;\n\n  ctx.font = `${bold ? 'bold' : ''} ${italic ? 'italic' : ''} ${fontSize}px \"${font}\"`;\n  ctx.fillStyle = color;\n};\n\nexport const splitTextInLines = (ctx, maxWidth, textAttrs, text) => {\n  const {fontSize} = textAttrs;\n\n  setupCtx(ctx, textAttrs);\n\n  const paras = text.split('\\n');\n  const words = paras.map(para => para.split(' ')).reduce((acc, words, idx) => {\n    const a = idx == paras.length - 1 ? [] : ['\\n'];\n    return acc.concat(words).concat(a);\n  }, []);\n  let lines = [''];\n  let indices = [[]];\n\n  let lastGlobIdx = 0;\n  words.forEach((word, idx) => {\n    if (word === '\\n') {\n      indices.push([]);\n      lines.push('');\n      return;\n    }\n    const lastIdx = lines.length-1;\n    let lastLine = lines[lastIdx]\n    const newText = lastLine.length === 0 ? word : lastLine + ' ' + word;\n    if (ctx.measureText(newText).width <= maxWidth || lastLine.length === 0) {\n      lines[lastIdx] = newText;\n      const empty = lastLine.length === 0;\n      indices[lastIdx] = indices[lastIdx].concat(word.split('').map((_, i) => lastGlobIdx + 1 + i));\n    } else {\n      indices.push(word.split('').map((_, i) => lastGlobIdx + 1 + i));\n      lines.push(word);\n    }\n    indices[lines.length-1].push(lastGlobIdx + 1 + word.length);\n    lastGlobIdx = lastGlobIdx + 1 + word.length\n  });\n\n  return [lines, indices];\n};\n\nexport const findIdxForCursor = (ctx, textRect, cursorAt, textAttrs, text) => {\n  const {fontSize} = textAttrs;\n\n  setupCtx(ctx, textAttrs);\n\n  const maxWidth = MAX_TEXT_WIDTH;\n  const [lines, mapIndices] = splitTextInLines(ctx, maxWidth, textAttrs, text);\n  const spaced = fontSize * 1.3;\n  let cursor;\n  lines.forEach((line, idx) => {\n    const x = textRect[0] + 10;\n    const y = textRect[1] + fontSize + (idx * spaced);\n    // find cursor\n    if (cursorAt && cursorAt.y <= y && cursorAt.y >= y - spaced) {\n      line.split('').forEach((char, idx) => {\n        const wd0 = ctx.measureText(line.slice(0, idx)).width;\n        const wd1 = ctx.measureText(line.slice(0, idx+1)).width;\n        const curX = cursorAt.x - x;\n        if (curX >= wd0 && curX <= wd1) {\n          cursor = text.indexOf(line) + idx;\n        }\n      });\n    }\n  });\n  return cursor !== undefined ? cursor + 1 : null;\n};\n\nexport const coordsForLine = (textRect, textAttrs, lineNo) => {\n  const {fontSize} = textAttrs;\n\n  const spaced = fontSize * 1.3;\n  return { x: textRect[0] + 10, y: textRect[1] + fontSize + (lineNo * spaced) };\n};\n\nexport const findPosForCursor = (ctx, cursor, textAttrs, text) => {\n  const {fontSize} = textAttrs;\n\n  setupCtx(ctx, textAttrs);\n\n  const maxWidth = MAX_TEXT_WIDTH;\n  const [lines, mapIndices] = splitTextInLines(ctx, maxWidth, fontSize, text);\n\n  if (cursor === 0) {\n    return {lineNo: 0, idxInLine: 0, line: ['']};\n  };\n\n  const line = mapIndices.find(line => line.indexOf(cursor) !== -1);\n  let pos;\n  if (line) {\n    const lineNo = mapIndices.indexOf(line);\n    const idxInLine = line.indexOf(cursor);\n    const lineText = line.map(i => text[i-1]).join('');\n\n    pos = {lineNo, idxInLine, line};\n  }\n  return pos;\n};\n\nexport const findCoordsForPos = (ctx, textRect, textAttrs, text, pos) => {\n  const {fontSize} = textAttrs;\n  setupCtx(ctx, textAttrs);\n\n  const {lineNo, idxInLine, line} = pos;\n  const lineText = line.map(i => text[i-1]).join('');\n\n  const {x, y} = coordsForLine(textRect, textAttrs, lineNo);\n  const wd1 = ctx.measureText(lineText.slice(0, idxInLine + 1)).width;\n\n  return { x: x+wd1, y1: y-fontSize+7, y2: y+7 };\n};\n\nexport const findRectsForSelection = (ctx, textRect, cursor1, cursor2, textAttrs, text) => {\n  const {fontSize} = textAttrs;\n  setupCtx(ctx, textAttrs);\n\n  let idx1 = cursor1;\n  let idx2 = cursor2;\n  if (idx1 > idx2) {\n    [idx1, idx2] = [idx2, idx1];\n  }\n  const pos1 = findPosForCursor(ctx, idx1, textAttrs, text);\n  const pos2 = findPosForCursor(ctx, idx2, textAttrs, text);\n\n  if (!(pos1 && pos2)) return;\n  const [lines, mapIndices] = splitTextInLines(ctx, MAX_TEXT_WIDTH, textAttrs, text);\n\n  if (pos1.lineNo === pos2.lineNo) {\n    const line = mapIndices.find(line => line.indexOf(idx1+1) !== -1);\n    const lineText = line.map(i => text[i-1]).join('');\n    const {x, y} = coordsForLine(textRect, textAttrs, pos1.lineNo);\n    const wd1 = ctx.measureText(lineText.slice(0, pos1.idxInLine)).width;\n    const wd2 = ctx.measureText(lineText.slice(pos1.idxInLine, pos2.idxInLine)).width;\n\n    return [{x1:x+wd1, x2:x+wd1+wd2, y1: y-fontSize+7, y2:y+7 }];\n  } else {\n    const lineNos = Array.apply(0, Array(pos2.lineNo - pos1.lineNo + 1)).map((_, idx) => idx + pos1.lineNo);\n\n    return lineNos.map(lineNo => {\n      const {x, y} = coordsForLine(textRect, textAttrs, lineNo);\n\n      let wd1, wd2;\n      if (lineNo == pos1.lineNo) {\n        const line = mapIndices.find(line => line.indexOf(idx1+1) !== -1);\n        const lineText = line.map(i => text[i-1]).join('');\n        wd1 = ctx.measureText(lineText.slice(0, pos1.idxInLine)).width;\n        wd2 = ctx.measureText(lineText.slice(pos1.idxInLine)).width;\n      } else if (lineNo === pos2.lineNo) {\n        const line = mapIndices.find(line => line.indexOf(idx2) !== -1);\n        const lineText = line.map(i => text[i-1]).join('');\n        wd1 = 0;\n        wd2 = ctx.measureText(lineText.slice(0, pos2.idxInLine)).width;\n      } else {\n        const line = mapIndices[lineNo];\n        const lineText = line.map(i => text[i-1]).join('');\n        wd1 = 0\n        wd2 = ctx.measureText(lineText).width;\n      }\n      return {x1:x+wd1, x2:x+wd1+wd2, y1: y-fontSize+7, y2:y+7 };\n    });\n  }\n};\n\nexport const addText = (ctx, textAttrs, _textRect, text) => {\n  const {fontSize} = textAttrs;\n  setupCtx(ctx, textAttrs);\n\n  const textRect = _textRect.slice();\n\n  const maxWidth = MAX_TEXT_WIDTH;\n  const [lines, mapIndices] = splitTextInLines(ctx, maxWidth, textAttrs, text);\n\n  const spaced = fontSize * 1.3;\n  lines.forEach((line, idx) => {\n    const {x, y} = coordsForLine(textRect, textAttrs, idx);\n    ctx.fillText(line, x, y, textRect[2]-20);\n  });\n\n  const totalHeight = lines.length * spaced;\n\n  textRect[3] = totalHeight + 10;\n\n  return textRect;\n};\n","export default class TextEditor {\n  constructor(component) {\n    this.component = component;\n    this.cursor = 0;\n    this.cursor1 = null;\n    this.cursor2 = null;\n    this.showCursor = false;\n  }\n\n  toggleCursor() {\n    this.showCursor = !this.showCursor;\n  }\n\n  setFromInput(selectionStart, selectionEnd) {\n    if (selectionStart === selectionEnd) {\n      this.cursor = selectionStart;\n      this.cursor1 = null;\n      this.cursor2 = null;\n    } else {\n      this.cursor = null;\n      this.cursor1 = selectionStart;\n      this.cursor2 = selectionEnd + 1;\n    }\n  }\n\n  setSelection(idx1, idx2, txt) {\n    this.cursor1 = idx1;\n    this.cursor2 = idx2;\n\n    txt.setSelectionRange(idx1, idx2 - 1);\n  }\n\n  setCursor(idx, txt) {\n    this.cursor = idx || this.cursor;\n    this.cursor1 = null;\n    this.cursor2 = null;\n\n    txt.setSelectionRange(this.cursor, this.cursor);\n  }\n}\n","// TODO: query a real API\n\nconst images = [\n  { url: 'https://images.unsplash.com/photo-1461016951828-c09537329b3a?fm=jpg', tags: ['field', 'landscape', 'sunlight'] },\n  { url: 'https://images.unsplash.com/photo-1461295025362-7547f63dbaea?fm=jpg', tags: ['crops'] },\n  { url: 'https://images.unsplash.com/photo-1465326117523-6450112b60b2?fm=jpg', tags: ['forest', 'hill'] },\n  { url: 'https://images.unsplash.com/photo-1458640904116-093b74971de9?fm=jpg', tags: ['dark', 'field'] },\n  //{ url: 'https://images.unsplash.com/photo-1453227588063-bb302b62f50b?fm=jpg' },\n  //{ url: 'https://images.unsplash.com/photo-1451906278231-17b8ff0a8880?fm=jpg' },\n  { url: 'https://images.unsplash.com/photo-1447969025943-8219c41ea47a?fm=jpg', tags: ['cat', 'kitten'] },\n  { url: 'https://images.unsplash.com/photo-1421749810611-438cc492b581?fm=jpg', tags: ['water', 'landscape'] },\n  { url: 'https://images.unsplash.com/photo-1449960238630-7e720e630019?fm=jpg', tags: ['water', 'seaside'] },\n  { url: 'https://images.unsplash.com/photo-1433190152045-5a94184895da?fm=jpg', tags: ['water', 'cliff'] }\n];\n\nexport const getPopularImages = () => Promise.resolve(images);\n\nexport const searchImages = (query) => {\n  const filteredImages = images.filter(img => {\n    return img.tags.some(tag => {\n      return tag.indexOf(query) !== -1;\n    });\n  });\n  return Promise.resolve(filteredImages);\n};\n"]}